<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Italy Trip Planner (vibe)</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root{
      --bg:#0b0f17; --card:#121a27; --muted:#7f8aa3; --text:#e9eefc;
      --line:#1f2a3d; --accent:#7c5cff; --accent2:#2dd4bf; --danger:#ff5c7a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", sans-serif;
      background: radial-gradient(1000px 600px at 15% 10%, rgba(124,92,255,.25), transparent 55%),
                  radial-gradient(900px 500px at 80% 0%, rgba(45,212,191,.18), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    header{
      padding:18px 18px 10px 18px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      border-bottom:1px solid var(--line);
      position:sticky; top:0; background:rgba(11,15,23,.75); backdrop-filter: blur(10px);
      z-index:10;
    }
    header h1{font-size:16px; margin:0; letter-spacing:.4px}
    header .sub{color:var(--muted); font-size:12px}
    .wrap{display:grid; grid-template-columns: 1.2fr .8fr; gap:14px; padding:14px; max-width:1200px; margin:0 auto;}
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr;} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    .card .hd{
      padding:12px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--line);
    }
    .card .hd .title{font-size:13px; font-weight:600}
    .card .hd .hint{font-size:12px; color:var(--muted)}
    #map{height:540px; width:100%;}
    @media (max-width: 980px){ #map{height:420px;} }

    .cols{display:grid; grid-template-columns: 1fr; gap:14px;}
    .pad{padding:12px;}
    input, select, button, textarea{
      font:inherit;
      border-radius:10px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      color:var(--text);
      padding:10px 10px;
      outline:none;
    }
    input::placeholder, textarea::placeholder{color:#8b95ad}
    textarea{resize: vertical; min-height: 72px}
    button{
      cursor:pointer;
      background: linear-gradient(180deg, rgba(124,92,255,.95), rgba(124,92,255,.7));
      border:1px solid rgba(124,92,255,.6);
    }
    button.secondary{
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
    }
    button.danger{
      background: rgba(255,92,122,.12);
      border: 1px solid rgba(255,92,122,.35);
      color: #ffd7df;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .row > *{flex:1}
    .row .fit{flex:0 0 auto}
    .pill{
      font-size:11px; color:#cfd6ea; border:1px solid var(--line);
      padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.04);
    }
    .list{display:flex; flex-direction:column; gap:10px;}
    .item{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius:12px;
      padding:10px;
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
    }
    .item .meta{min-width:0}
    .item .name{font-weight:700; font-size:13px; margin-bottom:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .item .desc{font-size:12px; color:var(--muted); line-height:1.35}
    .item .actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    .btn-sm{padding:8px 10px; font-size:12px; border-radius:10px}
    .tiny{font-size:11px; color:var(--muted)}
    .grid2{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    @media (max-width:980px){ .grid2{grid-template-columns:1fr;} }

    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden;}
    th, td{border-bottom:1px solid var(--line); padding:10px 8px; font-size:12px; vertical-align:top;}
    th{color:#cfd6ea; text-align:left; font-weight:700; background: rgba(255,255,255,.03)}
    tr:hover td{background: rgba(255,255,255,.03)}
    .td-actions{white-space:nowrap}
    .muted{color:var(--muted)}
    .ok{color: #b8ffe5}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size:11px;
      border:1px solid var(--line); padding:2px 6px; border-radius:8px; background: rgba(255,255,255,.05);}
  </style>
</head>

<body>
<header>
  <div>
    <h1>ğŸ‡®ğŸ‡¹ Italy Trip Planner <span class="pill">vibe coding</span></h1>
    <div class="sub">åœ°åœ–ï¼‹æ™¯é»åº«ï¼‹è¡Œç¨‹è¡¨æ ¼ï¼ˆè‡ªå‹•ä¿å­˜åˆ°ç€è¦½å™¨ localStorageï¼‰</div>
  </div>
  <div class="row" style="justify-content:flex-end">
    <button class="secondary btn-sm" id="btnExport">åŒ¯å‡º JSON</button>
    <button class="danger btn-sm" id="btnReset">é‡ç½®è³‡æ–™</button>
  </div>
</header>

<div class="wrap">
  <!-- Left: Map -->
  <section class="card">
    <div class="hd">
      <div>
        <div class="title">ğŸ—ºï¸ Map</div>
        <div class="hint">é» marker çœ‹æ™¯é» â†’ åŠ å…¥ Day è¡Œç¨‹</div>
      </div>
      <div class="row" style="max-width:420px">
        <input id="searchPlace" placeholder="æœå°‹æ™¯é»ï¼ˆåç¨±/åŸå¸‚/æ¨™ç±¤ï¼‰" />
        <button class="secondary btn-sm fit" id="btnFit">Fit</button>
      </div>
    </div>
    <div id="map"></div>
    <div class="pad tiny">
      Tipsï¼šåœ¨åœ°åœ–ä¸Š <span class="kbd">Shift + Click</span> ä¹Ÿå¯ä»¥å¿«é€Ÿæ–°å¢æ™¯é»ï¼ˆæœƒæŠ“é»é¸åº§æ¨™ï¼‰ã€‚
    </div>
  </section>

  <!-- Right: Places + Itinerary -->
  <section class="cols">
    <section class="card">
      <div class="hd">
        <div>
          <div class="title">ğŸ“ Placesï¼ˆæ™¯é»åº«ï¼‰</div>
          <div class="hint">ä½ å¯ä»¥æŠŠé€™å¼µè¡¨ç•¶ã€Œè³‡æ–™åº«ã€</div>
        </div>
        <div class="row" style="max-width:340px">
          <select id="cityFilter">
            <option value="">å…¨éƒ¨åŸå¸‚</option>
          </select>
          <button class="secondary btn-sm fit" id="btnSeed">åŒ¯å…¥ç¾©å¤§åˆ©å¸¸è¦‹é»</button>
        </div>
      </div>

      <div class="pad">
        <div class="grid2">
          <input id="pName" placeholder="æ™¯é»åç¨±ï¼ˆä¾‹ï¼šDuomo di Milanoï¼‰" />
          <input id="pCity" placeholder="åŸå¸‚ï¼ˆä¾‹ï¼šMilanï¼‰" />
          <input id="pTags" placeholder="æ¨™ç±¤ï¼ˆé€—è™Ÿåˆ†éš”ï¼šchurch, viewï¼‰" />
          <select id="pType">
            <option value="landmark">landmark</option>
            <option value="museum">museum</option>
            <option value="food">food</option>
            <option value="nature">nature</option>
            <option value="shopping">shopping</option>
          </select>
          <input id="pLat" placeholder="ç·¯åº¦ latï¼ˆä¾‹ï¼š45.4642ï¼‰" />
          <input id="pLng" placeholder="ç¶“åº¦ lngï¼ˆä¾‹ï¼š9.1916ï¼‰" />
        </div>

        <div class="row" style="margin-top:10px">
          <textarea id="pNote" placeholder="å‚™è¨»ï¼ˆå¯ç©ºï¼‰ï¼šä¾‹å¦‚ã€å»ºè­°ä¸Šé ‚æ¨“çœ‹å¤•é™½ã€"></textarea>
        </div>

        <div class="row" style="margin-top:10px">
          <button id="btnAddPlace">æ–°å¢æ™¯é»</button>
          <button class="secondary" id="btnUseCenter">ç”¨åœ°åœ–ä¸­å¿ƒåº§æ¨™</button>
        </div>
      </div>

      <div class="pad" style="padding-top:0">
        <div class="list" id="placesList"></div>
      </div>
    </section>

    <section class="card">
      <div class="hd">
        <div>
          <div class="title">ğŸ§© Itineraryï¼ˆè¡Œç¨‹è¡¨æ ¼ï¼‰</div>
          <div class="hint">å…ˆæ’é †åºï¼Œå†è£œæ™‚é–“ï¼›æ”¯æŒä¸Šä¸‹ç§»å‹•æ’åº</div>
        </div>
        <div class="row" style="max-width:360px; justify-content:flex-end">
          <select id="daySelect"></select>
          <button class="secondary btn-sm fit" id="btnAddDay">+ Day</button>
        </div>
      </div>

      <div class="pad">
        <div class="row">
          <input id="dayTitle" placeholder="ç•¶å¤©æ¨™é¡Œï¼ˆå¯é¸ï¼‰ï¼šä¾‹å¦‚ã€ç¾…é¦¬å¤è¹Ÿæ—¥ã€" />
          <button class="secondary fit" id="btnSaveDayTitle">å„²å­˜æ¨™é¡Œ</button>
        </div>
      </div>

      <div class="pad" style="padding-top:0">
        <table>
          <thead>
            <tr>
              <th style="width:70px">é †åº</th>
              <th>é …ç›®</th>
              <th style="width:120px">åœç•™</th>
              <th style="width:140px">å‚™è¨»</th>
              <th class="td-actions" style="width:180px">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="itTable"></tbody>
        </table>
        <div class="tiny muted" style="margin-top:8px">
          æƒ³æ›´çˆ½ï¼šä¸‹ä¸€æ­¥å¯ä»¥åŠ ã€Œæ‹–æ‹‰æ’åºï¼ˆdrag & dropï¼‰ã€å’Œã€Œè·¯ç·šè·é›¢/äº¤é€šæ™‚é–“ä¼°ç®—ã€ã€‚
        </div>
      </div>
    </section>
  </section>
</div>

<script>
/** ========= VIBE ITALY PLANNER =========
 *  - Leaflet map (OSM)
 *  - Places list + markers
 *  - Itinerary per day (table), add from place
 *  - LocalStorage persistence
 */

const STORAGE_KEY = "italy_trip_planner_v1";

function uid(prefix="id"){
  return prefix + "_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
}

function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return null;
  try { return JSON.parse(raw); } catch(e){ return null; }
}
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

let state = loadState() || {
  trip: { name: "Italy Trip", createdAt: Date.now() },
  places: [],
  days: [
    { id: uid("day"), title: "", items: [] }
  ],
  ui: { selectedDayId: null }
};

if(!state.ui.selectedDayId) state.ui.selectedDayId = state.days[0].id;

// --- Leaflet Map ---
const map = L.map('map', { zoomControl: true }).setView([41.9028, 12.4964], 5); // Rome-ish
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19, attribution: '&copy; OpenStreetMap'
}).addTo(map);

let markersLayer = L.layerGroup().addTo(map);

function rebuildMarkers(filteredPlaces){
  markersLayer.clearLayers();
  (filteredPlaces || state.places).forEach(p => {
    if(typeof p.lat !== "number" || typeof p.lng !== "number") return;
    const m = L.marker([p.lat, p.lng]).addTo(markersLayer);
    m.bindPopup(`
      <b>${escapeHtml(p.name)}</b><br/>
      <span style="color:#7f8aa3">${escapeHtml(p.city || "")} â€¢ ${escapeHtml(p.type || "")}</span><br/>
      <div style="margin-top:6px;font-size:12px">${escapeHtml(p.note || "")}</div>
      <div style="margin-top:8px">
        <button onclick="window.__addToDay('${p.id}')" style="padding:6px 10px;border-radius:10px;border:1px solid #1f2a3d;background:rgba(255,255,255,.06);color:#e9eefc;cursor:pointer;">
          åŠ å…¥è¡Œç¨‹ï¼ˆç›®å‰ Dayï¼‰
        </button>
      </div>
    `);
  });
}

window.__addToDay = function(placeId){
  const place = state.places.find(x => x.id === placeId);
  if(!place) return;
  addPlaceToItinerary(placeId);
  // try open itinerary section vibe
  alert(`å·²åŠ å…¥ï¼š${place.name}`);
}

// Shift+Click to add place with coordinate
map.on('click', (e) => {
  if(!e.originalEvent.shiftKey) return;
  document.getElementById("pLat").value = e.latlng.lat.toFixed(6);
  document.getElementById("pLng").value = e.latlng.lng.toFixed(6);
  document.getElementById("pName").focus();
});

// --- UI elements ---
const elPlacesList = document.getElementById("placesList");
const elCityFilter = document.getElementById("cityFilter");
const elSearch = document.getElementById("searchPlace");

const elDaySelect = document.getElementById("daySelect");
const elItTable = document.getElementById("itTable");
const elDayTitle = document.getElementById("dayTitle");

function escapeHtml(str){
  return (str ?? "").toString()
    .replaceAll("&","&amp;").replaceAll("<","&lt;")
    .replaceAll(">","&gt;").replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function currentDay(){
  return state.days.find(d => d.id === state.ui.selectedDayId) || state.days[0];
}

function upsertCityOptions(){
  const cities = Array.from(new Set(state.places.map(p => (p.city||"").trim()).filter(Boolean))).sort();
  const cur = elCityFilter.value;
  elCityFilter.innerHTML = `<option value="">å…¨éƒ¨åŸå¸‚</option>` + cities.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join("");
  elCityFilter.value = cities.includes(cur) ? cur : "";
}

function rebuildPlacesList(){
  const q = (elSearch.value || "").trim().toLowerCase();
  const city = (elCityFilter.value || "").trim();
  const filtered = state.places.filter(p => {
    if(city && (p.city||"") !== city) return false;
    if(!q) return true;
    const hay = `${p.name} ${p.city} ${(p.tags||[]).join(" ")} ${p.type} ${p.note||""}`.toLowerCase();
    return hay.includes(q);
  });

  rebuildMarkers(filtered);

  elPlacesList.innerHTML = filtered.map(p => `
    <div class="item">
      <div class="meta">
        <div class="name">${escapeHtml(p.name)}</div>
        <div class="desc">
          ${escapeHtml(p.city || "â€”")} â€¢ <span class="ok">${escapeHtml(p.type||"")}</span>
          ${p.tags?.length ? ` â€¢ <span class="muted">${escapeHtml(p.tags.join(", "))}</span>` : ""}
          <div class="tiny" style="margin-top:4px">${escapeHtml(p.note || "")}</div>
        </div>
        <div class="tiny">(${p.lat?.toFixed?.(5) ?? "?"}, ${p.lng?.toFixed?.(5) ?? "?"})</div>
      </div>
      <div class="actions">
        <button class="secondary btn-sm" onclick="flyToPlace('${p.id}')">å®šä½</button>
        <button class="btn-sm" onclick="addPlaceToItinerary('${p.id}')">åŠ å…¥ Day</button>
        <button class="danger btn-sm" onclick="deletePlace('${p.id}')">åˆªé™¤</button>
      </div>
    </div>
  `).join("");

  saveState();
}

function flyToPlace(placeId){
  const p = state.places.find(x => x.id === placeId);
  if(!p) return;
  if(typeof p.lat === "number" && typeof p.lng === "number"){
    map.flyTo([p.lat, p.lng], 13, { duration: 0.8 });
  }
}

function deletePlace(placeId){
  state.places = state.places.filter(p => p.id !== placeId);
  // Also remove from all itineraries
  state.days.forEach(d => d.items = d.items.filter(it => it.placeId !== placeId));
  upsertCityOptions();
  rebuildDaySelect();
  rebuildPlacesList();
  rebuildItineraryTable();
  saveState();
}

function rebuildDaySelect(){
  elDaySelect.innerHTML = state.days.map((d, idx) => {
    const label = `Day ${idx+1}` + (d.title ? ` â€¢ ${d.title}` : "");
    return `<option value="${d.id}">${escapeHtml(label)}</option>`;
  }).join("");
  elDaySelect.value = state.ui.selectedDayId;
  // update title box
  elDayTitle.value = currentDay().title || "";
}

function addDay(){
  const d = { id: uid("day"), title:"", items:[] };
  state.days.push(d);
  state.ui.selectedDayId = d.id;
  rebuildDaySelect();
  rebuildItineraryTable();
  saveState();
}

function saveDayTitle(){
  const d = currentDay();
  d.title = (elDayTitle.value || "").trim();
  rebuildDaySelect();
  saveState();
}

function addPlaceToItinerary(placeId){
  const p = state.places.find(x => x.id === placeId);
  if(!p) return;
  const d = currentDay();
  d.items.push({
    id: uid("it"),
    placeId,
    stayMin: 90,
    note: ""
  });
  rebuildItineraryTable();
  saveState();
}

function moveItem(itemId, dir){
  const d = currentDay();
  const idx = d.items.findIndex(x => x.id === itemId);
  if(idx < 0) return;
  const nidx = clamp(idx + dir, 0, d.items.length - 1);
  if(nidx === idx) return;
  const [it] = d.items.splice(idx,1);
  d.items.splice(nidx,0,it);
  rebuildItineraryTable();
  saveState();
}

function deleteItem(itemId){
  const d = currentDay();
  d.items = d.items.filter(x => x.id !== itemId);
  rebuildItineraryTable();
  saveState();
}

function setItemStay(itemId, value){
  const d = currentDay();
  const it = d.items.find(x => x.id === itemId);
  if(!it) return;
  const n = parseInt(value,10);
  it.stayMin = Number.isFinite(n) ? clamp(n, 0, 24*60) : it.stayMin;
  saveState();
}

function setItemNote(itemId, value){
  const d = currentDay();
  const it = d.items.find(x => x.id === itemId);
  if(!it) return;
  it.note = value;
  saveState();
}

function rebuildItineraryTable(){
  const d = currentDay();
  const rows = d.items.map((it, idx) => {
    const p = state.places.find(x => x.id === it.placeId);
    const name = p ? p.name : "(å·²åˆªé™¤æ™¯é»)";
    const city = p ? p.city : "";
    return `
      <tr>
        <td class="muted">${idx+1}</td>
        <td>
          <div style="font-weight:700">${escapeHtml(name)}</div>
          <div class="tiny muted">${escapeHtml(city)} ${p?.type ? "â€¢ " + escapeHtml(p.type) : ""}</div>
        </td>
        <td>
          <input style="width:100%" type="number" min="0" step="5" value="${it.stayMin ?? 0}"
            oninput="setItemStay('${it.id}', this.value)" />
          <div class="tiny muted">åˆ†é˜</div>
        </td>
        <td>
          <input style="width:100%" value="${escapeHtml(it.note || "")}"
            oninput="setItemNote('${it.id}', this.value)" placeholder="å‚™è¨»" />
        </td>
        <td class="td-actions">
          <button class="secondary btn-sm" onclick="moveItem('${it.id}', -1)">â†‘</button>
          <button class="secondary btn-sm" onclick="moveItem('${it.id}', 1)">â†“</button>
          <button class="secondary btn-sm" onclick="flyToPlace('${it.placeId}')">å®šä½</button>
          <button class="danger btn-sm" onclick="deleteItem('${it.id}')">åˆª</button>
        </td>
      </tr>
    `;
  }).join("");

  elItTable.innerHTML = rows || `<tr><td colspan="5" class="muted">ç›®å‰ Day é‚„æ²’æœ‰è¡Œç¨‹ã€‚å»å·¦é‚Š Places åŠ å…¥å¹¾å€‹å§ï½</td></tr>`;
  saveState();
}

// --- Add Place form ---
document.getElementById("btnAddPlace").addEventListener("click", () => {
  const name = document.getElementById("pName").value.trim();
  const city = document.getElementById("pCity").value.trim();
  const tags = document.getElementById("pTags").value.split(",").map(s=>s.trim()).filter(Boolean);
  const type = document.getElementById("pType").value;
  const note = document.getElementById("pNote").value.trim();
  const lat = parseFloat(document.getElementById("pLat").value);
  const lng = parseFloat(document.getElementById("pLng").value);

  if(!name){ alert("è«‹è¼¸å…¥æ™¯é»åç¨±"); return; }
  if(!Number.isFinite(lat) || !Number.isFinite(lng)){
    alert("è«‹è¼¸å…¥æœ‰æ•ˆåº§æ¨™ï¼ˆæˆ–æŒ‰ã€ç”¨åœ°åœ–ä¸­å¿ƒåº§æ¨™ã€ï¼Œæˆ– Shift+Click åœ°åœ–æŠ“åº§æ¨™ï¼‰");
    return;
  }

  state.places.unshift({ id: uid("pl"), name, city, tags, type, note, lat, lng });
  // clear a bit
  document.getElementById("pName").value = "";
  document.getElementById("pTags").value = "";
  document.getElementById("pNote").value = "";

  upsertCityOptions();
  rebuildPlacesList();
  saveState();
});

document.getElementById("btnUseCenter").addEventListener("click", () => {
  const c = map.getCenter();
  document.getElementById("pLat").value = c.lat.toFixed(6);
  document.getElementById("pLng").value = c.lng.toFixed(6);
});

elCityFilter.addEventListener("change", rebuildPlacesList);
elSearch.addEventListener("input", rebuildPlacesList);

// --- Day controls ---
elDaySelect.addEventListener("change", () => {
  state.ui.selectedDayId = elDaySelect.value;
  rebuildDaySelect();
  rebuildItineraryTable();
  saveState();
});
document.getElementById("btnAddDay").addEventListener("click", addDay);
document.getElementById("btnSaveDayTitle").addEventListener("click", saveDayTitle);

// --- Export / Reset / Fit ---
document.getElementById("btnExport").addEventListener("click", () => {
  const blob = new Blob([JSON.stringify(state, null, 2)], { type:"application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "italy-trip.json";
  a.click();
  URL.revokeObjectURL(url);
});

document.getElementById("btnReset").addEventListener("click", () => {
  if(!confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼Ÿï¼ˆlocalStorage æœƒè¢«åˆªæ‰ï¼‰")) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
});

document.getElementById("btnFit").addEventListener("click", () => {
  if(state.places.length === 0) { map.setView([41.9028, 12.4964], 5); return; }
  const latlngs = state.places
    .filter(p => Number.isFinite(p.lat) && Number.isFinite(p.lng))
    .map(p => [p.lat, p.lng]);
  if(latlngs.length === 0) return;
  map.fitBounds(latlngs, { padding:[30,30] });
});

// Seed Italy common places
document.getElementById("btnSeed").addEventListener("click", () => {
  const seed = [
    { name:"Duomo di Milano", city:"Milan", type:"landmark", tags:["church","view"], note:"å¯ä¸Šé ‚æ¨“çœ‹å¤•é™½", lat:45.464167, lng:9.191389 },
    { name:"Galleria Vittorio Emanuele II", city:"Milan", type:"shopping", tags:["architecture","shopping"], note:"æ—é‚Šå°±æ˜¯å¤§æ•™å ‚", lat:45.465833, lng:9.190278 },
    { name:"Piazza del Duomo", city:"Milan", type:"landmark", tags:["square"], note:"å¤§æ•™å ‚å»£å ´", lat:45.464444, lng:9.190000 },

    { name:"Ponte Vecchio", city:"Florence", type:"landmark", tags:["bridge","sunset"], note:"å‚æ™šå¾ˆç¾", lat:43.767928, lng:11.253144 },
    { name:"Uffizi Gallery", city:"Florence", type:"museum", tags:["art","booking"], note:"å¼·çƒˆå»ºè­°é è¨‚æ™‚æ®µ", lat:43.768700, lng:11.255000 },
    { name:"Galleria dell'Accademia", city:"Florence", type:"museum", tags:["David","booking"], note:"å¤§è¡›åƒ", lat:43.776900, lng:11.258300 },
    { name:"Piazzale Michelangelo", city:"Florence", type:"landmark", tags:["view","sunset"], note:"ä¿¯ç°ä½›ç¾…å€«æ–¯å¤œæ™¯", lat:43.762900, lng:11.265700 },

    { name:"Colosseum", city:"Rome", type:"landmark", tags:["ancient","booking"], note:"å»ºè­°æ—©ä¸Šç¬¬ä¸€å ´", lat:41.890200, lng:12.492200 },
    { name:"Roman Forum", city:"Rome", type:"landmark", tags:["ancient"], note:"å¯èˆ‡æ–—ç¸å ´åŒæ—¥", lat:41.892500, lng:12.485300 },
    { name:"Pantheon", city:"Rome", type:"landmark", tags:["architecture"], note:"åœ“é ‚ç¥æ®¿", lat:41.898610, lng:12.476870 },
    { name:"Vatican Museums", city:"Vatican", type:"museum", tags:["booking","art"], note:"å¼·çƒˆå»ºè­°é è¨‚", lat:41.906487, lng:12.453621 },
    { name:"St. Peter's Basilica", city:"Vatican", type:"landmark", tags:["church","view"], note:"ç™»é ‚çœ‹å…¨æ™¯", lat:41.902200, lng:12.453900 },

    { name:"St. Mark's Basilica", city:"Venice", type:"landmark", tags:["church","booking"], note:"æ—©åˆ°é¿äººæ½®", lat:45.434200, lng:12.339000 },
    { name:"Rialto Bridge", city:"Venice", type:"landmark", tags:["bridge"], note:"æ—¥è½æ™‚æ®µå¾ˆè®š", lat:45.438000, lng:12.335800 },
    { name:"Burano Island", city:"Venice", type:"landmark", tags:["island","colorful"], note:"å½©è‰²å³¶", lat:45.485800, lng:12.416700 },

    { name:"Manarola (Cinque Terre)", city:"Cinque Terre", type:"nature", tags:["sea","sunset"], note:"äº”æ¼æ‘ç¶“å…¸æµ·æ™¯", lat:44.107500, lng:9.729700 },
    { name:"Vernazza (Cinque Terre)", city:"Cinque Terre", type:"nature", tags:["sea"], note:"æ¸¯ç£è¦–è§’å¾ˆç¾", lat:44.134000, lng:9.683900 },
  ];

  // avoid duplicates by name+city
  const existingKey = new Set(state.places.map(p => `${p.name}__${p.city}`));
  seed.forEach(s => {
    const key = `${s.name}__${s.city}`;
    if(existingKey.has(key)) return;
    state.places.push({ id: uid("pl"), ...s });
  });

  upsertCityOptions();
  rebuildPlacesList();
  saveState();
  document.getElementById("btnFit").click();
});

// --- init render ---
upsertCityOptions();
rebuildDaySelect();
rebuildPlacesList();
rebuildItineraryTable();
saveState();
</script>
</body>
</html>
